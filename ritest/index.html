<!DOCTYPE html>

<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" type="text/css" href="/common/styles.css">
  <script type="text/javascript" src="/common/common.js"></script>
  <link rel="stylesheet" type="text/css" href="./index.css">
</head>

<body>
  <egu-main>
    <div class="main_div">
      <h1>The RITZZ Test</h1>
      <h3>This test uses the 2 pillars of pureness: sex and danger.</h3>
      <div id="checkboxes" class="question_class">
        <!--checkboxes are added here-->
      </div>
      <br />
      <button id="submit">Calculate</button>
      <div>
        <br />
        Your Score: <div id="output"></div>
        <br /> <br />
        Max-Sex: <div id="maxSex"></div>
        Min-Sex: <div id="minSex"></div>
        Max-Danger: <div id="maxDanger"></div>
        Min-Danger: <div id="minDanger"></div>
      </div>
      <br />
      if you have ideas for questions, dm me.
    </div>
    <script src="jquery-3.6.4.min.js"></script>

    <script>
      // Define a function to load the questions from the CSV file
      let questions = [];
      function loadQuestions() {
        // Load the CSV file using jQuery's $.get method
        $.get("questions.csv", function (csv) {
          let lines = csv.split("\n");
          for (let i = 0; i < lines.length - 1; i++) {
            let line = lines[i].split(",");
            //casts line[0] to a string, and the rest ot floats
            //console.log(line[0] + " " + line[1] + " " + line[2] + " " + line[3] + " " + line[4]);
            questions.push(new createQuestion(String(line[0]),
              new createRating(parseFloat(line[1]), parseFloat(line[2])),
              new createRating(parseFloat(line[3]), parseFloat(line[4]))
            ));
          }
          for (let i = 0; i < questions.length; i++) {
            document.getElementById("checkboxes").innerHTML += questions[i].htmlString(i);
          }
          document.getElementById("submit").addEventListener("click", () => {
            let totalRating = new createRating(0, 0);

            let maxSexRating = new createRating(0, 0);
            let maxDangerRating = new createRating(0, 0);
            let minSexRating = new createRating(0, 0);
            let minDangerRating = new createRating(0, 0);

            for (let i = 0; i < questions.length; i++) {
              if (document.getElementById(`${i}`).checked) {
                totalRating = addRatings(totalRating, questions[i].checkedRating);
              } else {
                totalRating = addRatings(totalRating, questions[i].uncheckedRating);
              }

              //for finding max&min total sex rating and max&mim total danger rating
              if (questions[i].checkedRating.sexValue > questions[i].uncheckedRating.sexValue) {
                maxSexRating = addRatings(maxSexRating, questions[i].checkedRating);
                minSexRating = addRatings(minSexRating, questions[i].uncheckedRating);
              } else {
                maxSexRating = addRatings(maxSexRating, questions[i].uncheckedRating);
                minSexRating = addRatings(minSexRating, questions[i].checkedRating);
              }

              if (questions[i].checkedRating.dangerValue > questions[i].uncheckedRating.dangerValue) {
                maxDangerRating = addRatings(maxDangerRating, questions[i].checkedRating);
                minDangerRating = addRatings(minDangerRating, questions[i].uncheckedRating);
              } else {
                maxDangerRating = addRatings(maxDangerRating, questions[i].uncheckedRating);
                minDangerRating = addRatings(minDangerRating, questions[i].checkedRating);
              }
            }
            document.getElementById("output").innerHTML = ratingToString(totalRating);
            // `<br/>Sex Points: ${Math.round(totalRating.sexValue*100)/100}<br/> Danger Points: ${Math.round(totalRating.dangerValue*100)/100}`;
            document.getElementById("maxSex").innerHTML = ratingToString(maxSexRating);
            document.getElementById("minSex").innerHTML = ratingToString(minSexRating);
            document.getElementById("maxDanger").innerHTML = ratingToString(maxDangerRating);
            document.getElementById("minDanger").innerHTML = ratingToString(minDangerRating);

          });
        });
      }
      // Call the loadQuestions function after the jQuery library has loaded
      $(document).ready(function () {
        loadQuestions();
      });


      //question "class"
      function createQuestion(question, checkedRating, uncheckedRating) {
        this.htmlString = (index) => {
          return `<div class="question_box_div">${index + 1}: <input type="checkbox" id="${index}"> <label for=\"${index}\"">${question}</label></div>`
        }
        this.checkedRating = checkedRating;
        this.uncheckedRating = uncheckedRating;
        return this;
      }

      //rating "class"
      function createRating(sexValue, dangerValue) {
        this.sexValue = sexValue;
        this.dangerValue = dangerValue;
        return this;
      }
      function addRatings(rating1, rating2) {
        return new createRating(
          rating1.sexValue + rating2.sexValue,
          rating1.dangerValue + rating2.dangerValue
        );
      }
      function ratingToString(r) {
        return `Sex Points: ${Math.round(r.sexValue * 100) / 100}<br/> Danger Points: ${Math.round(r.dangerValue * 100) / 100}<br/><br/>`;
      }

    </script>
    </egu-m>
</body>

</html>